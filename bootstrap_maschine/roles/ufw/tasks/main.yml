---
- name: Check if this role has already been executed
  stat:
    path: "/var/log/ansible/{{ role_name }}.done"
  register: role_check

- name: Skip this role if already executed
  meta: end_play
  when: role_check.stat.exists

- import_tasks: install.yml

- import_tasks: service.yml

- import_tasks: config.yml

- import_tasks: manage.yml

- name: Mark this role as executed
  file:
    path: "/var/log/ansible/{{ role_name }}.done"
    state: touch
    mode: "0644"